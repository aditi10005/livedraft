<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>liveDraft</title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="css/style.css">
  
    <script type="text/javascript" src="js/jquery.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.20.2.js"></script>

  </head>
  <body>
    <div id="header"><p id="title">liveDraft</p></div>
    <div id="sidemenu">
      <button class="button-primary small_btn color_red" id="share_btn" onclick="startSharing()" >SHARE</button>
      <button class="small_btn" onclick="tryJoining()" id="join_btn" >JOIN</button>
    </div>
    <div id="container">
      <textarea id="main_writer" class="medium_font"></textarea>
    </div>

    <script>
      // You can also require other files to run in this process
      require('./renderer.js')
      var channel = Math.floor(Math.random() * 20)+"-"+Math.floor(Math.random() * 1000)+"-"+Math.floor(Math.random() * 100);
      var body = $("#main_writer").val();
      var sharing = false;

      function startSharing() {
        body = $("#main_writer").val();
        console.log(body);
        publish();
        //alert(uid);
      }

      $("#main_writer").keyup(function() {
          body = $("#main_writer").val();
          if (publish == true) {
            //keep publishing
          }
      });

      function publish() {
      sharing = true;
      pubnub = new PubNub({
          publishKey : 'pub-c-4c8b4681-1768-4bd1-b251-964e22884f07',
          subscribeKey : 'sub-c-d487f296-2515-11e8-9bf4-060db84035e6'
      })
      
      function publishSampleMessage() {
          console.log("Since we're publishing on subscribe connectEvent, we're sure we'll receive the following publish.");
          var publishConfig = {
              channel : channel,
              message : "Hello from PubNub Docs!"
          }
          pubnub.publish(publishConfig, function(status, response) {
              console.log(status, response);
          })
        }
      
        pubnub.addListener({
            status: function(statusEvent) {
                if (statusEvent.category === "PNConnectedCategory") {
                    publishSampleMessage();
                }
            },
            message: function(message) {
                console.log("New Message!!", message);
            },
            presence: function(presenceEvent) {
                // handle presence
            }
        })      
          console.log("Subscribing..");
          pubnub.subscribe({
              channels: [channel] 
          });
        };
    </script>
  </body>
</html>
